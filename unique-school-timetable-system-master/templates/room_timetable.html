{% extends 'layout.html' %}
{% block title %}Room Timetable{% endblock %}

{% block content %}
<div class="container mt-4">
    <h3 class="text-center mb-4">Room Timetable View</h3>

    <!-- Room Selection Form -->
    <form method="POST" class="form-inline justify-content-center mb-4">
        <label for="room_id" class="mr-2 font-weight-bold">Select Room:</label>
        <select name="room_id" id="room_id" class="form-control mr-2">
            {% for room in rooms %}
                <option value="{{ room.id }}" {% if selected_room and room.id == selected_room.id %}selected{% endif %}>
                    {{ room.name }} ({{ room.type }})
                </option>
            {% endfor %}
        </select>
        <button type="submit" class="btn btn-primary">View</button>
    </form>

    {% if grid %}
    <!-- Export Button -->
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h5 class="mb-0">Timetable for Room: {{ selected_room.name }}</h5>
        <a href="{{ url_for('room_timetable.export_room_timetable', room_id=selected_room.id) }}"
           class="btn btn-success">
            ðŸ“¥ Export to Excel
        </a>
    </div>

    <!-- Timetable Grid -->
    <table class="table table-bordered text-center table-striped">
        <thead class="thead-dark">
            <tr>
                <th>Time / Day</th>
                {% for day in days %}
                    <th>{{ day }}</th>
                {% endfor %}
            </tr>
        </thead>
        <tbody>
            {% for slot in time_slots %}
                <tr>
                    <th>{{ slot[0] }} - {{ slot[1] }}</th>
                    {% for day in days %}
                        <td>
                            {% if grid[slot][day] %}
                                {{ grid[slot][day]|safe }}
                            {% else %}
                                <span class="text-muted">No class</span>
                            {% endif %}
                        </td>
                    {% endfor %}
                </tr>
            {% endfor %}
        </tbody>
    </table>
    {% elif selected_room %}
        <div class="alert alert-warning text-center">No valid timetable entries for {{ selected_room.name }}.</div>
    {% endif %}
</div>
{% endblock %}
